import { Button, TabWidget, Palette, StandardButton } from "std-widgets.slint";
import { FixturesTab } from "fixtures-tab.slint";
import { FunctionsTab } from "functions-tab.slint";
import { VirtualConsoleTab } from "virtual-console-tab.slint";
import { Preview2D } from "views/preview-2d.slint";
import { FadersView } from "views/faders-view.slint";
import {
    Icons,
    BorderVert,
    BorderHorz,
    Theme,
} from "styling.slint";
import { TopBar } from "top-bar.slint";
import { TimeLineTab } from "timeline-tab.slint";
import { ToolTipArea } from "parts/tooltip.slint";
import "../assets/fonts/Inter-VariableFont_opsz,wght.ttf";
import { TitleBar } from "titlebar.slint";
import { MiddleText } from "parts/texts.slint";


export { Preview2DLogic } from "./views/preview-2d.slint";
export { FaderLogic } from "./views/faders-view.slint";

export global MenuBarActions {
    callback save();
    callback save-as();
}

export component AppWindow inherits Window {
    title: "Tsukuyomi";
    icon: Icons.default;
    no-frame: true;
    full-screen: true;
    default-font-family: "Inter";
    property <bool> showSaveDialog;
    callback start_drag();
    callback minimize();
    callback toggle-fullscreen();
    callback close();


    if Platform.os==OperatingSystemType.macos:MenuBar {
        Menu {
            title: @tr("File");
            MenuItem {
                title: @tr("New");
                activated => {};
            }
            MenuItem {
                title: @tr("Open");
                activated => {};
            }
            MenuItem {
                title: @tr("Open Recentry");
                activated => {};
            }
            MenuSeparator {}
            MenuItem {
                title: @tr("Save");
                activated =>{showSaveDialog=true;};
            }
            MenuItem {
                title: @tr("Save As");
                activated => {};
            }
        }
        Menu {
            title: @tr("Edit");
            MenuItem {
                title: @tr("Undo");
                activated => {};
            }
            MenuItem {
                title: @tr("Redo");
                activated => {};
            }
            MenuItem {
                title: @tr("Copy");
                activated => {};
            }
            MenuItem {
                title: @tr("Paste");
                activated => {};
            }
        }
        Menu {
            title: @tr("Help");
            MenuItem {
                title: @tr("About");
                activated => {};
            }
        }

    }

    content := VerticalLayout {
        //alignment: LayoutAlignment.start;

        if Platform.os!=OperatingSystemType.macos:TitleBar {
            minimize => root.minimize();
            toggle-fullscreen => root.toggle-fullscreen();
            close => root.close();
            show-tooltip(has-hover, x, y, msg) => tooltip.show-tooltip(has-hover, x, y, msg);
            //TODO: バケツリレー
        }

        //TopBar {}
        main-pane := TabWidget {
            //height: 70%;
            width: 100%;
            //orientation: Orientation.vertical;
            Tab {
                title: @tr("Fixtures");
                FixturesTab { }
            }

            Tab {
                title: @tr("Functions");
                FunctionsTab { }
            }

            Tab {
                title: @tr("TimeLine");
                TimeLineTab { }
            }

            Tab {
                title: @tr("Virtual Console");
                VirtualConsoleTab { }
            }
        }

        BorderVert { }

        bottom-panel := Rectangle {
            //drop-shadow-blur: 0.2rem;
            //drop-shadow-color: Palette.background;
            //height: 30%;

            HorizontalLayout {
                //height: 30%;
                //HorizontalSplit {}

                Preview2D { }

                BorderHorz { }

                FadersView { }
            }
        }
    }

    /*TouchArea {
        moved => {
            root.start_drag();
        }
    }*/



    save-dialog := Dialog {
        visible: root.showSaveDialog;
        MiddleText {
            text: @tr("Do you want to save before exit?");
        }

        StandardButton {
            kind: StandardButtonKind.yes;
        }

        StandardButton {
            kind: StandardButtonKind.no;
        }

        StandardButton {
            kind: StandardButtonKind.cancel;
            clicked => {
                save-dialog.visible = false;
            }
        }
    }

    tooltip := ToolTipArea { }
}
